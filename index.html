<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transport Accessibility Framework</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.0/nouislider.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.0/nouislider.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Trebuchet MS', sans-serif;
      font-weight: normal;
    }
    #map {
      height: 100%;
      width: 100%;
    }
    #panel-container {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      width: 275px;
      box-sizing: border-box;
    }
    .panel {
      margin-bottom: 10px;
    }
    .panel label, .panel select, .panel input {
      display: block;
      margin-bottom: 5px;
      font-family: 'Trebuchet MS', sans-serif;
      font-size: 1.1em;
      font-weight: normal;
    }
    .panel select, .panel input {
      width: 100%;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 3px;
      background-color: white;
      color: black;
      box-sizing: border-box;
      font-size: 1em;
    }
    .panel select:focus, .panel input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
    .panel input[type="range"] {
      width: 100%;
    }
    .field-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .field-container > div:first-child {
      flex: 1.05;
    }
    .field-container > div:last-child {
      flex: 0.95;
      margin-left: 10px;
    }
    .button-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .button-container > button {
      flex: 1;
      margin-left: 10px;
    }
    .button-container > button:first-child {
      margin-left: 0;
    }
    .collapsible {
      cursor: pointer;
      border: none;
      text-align: left;
      outline: none;
      font-size: 1em;
      background: #f0f0f0;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-radius: 5px;
      font-family: 'Trebuchet MS', sans-serif;
      font-weight: normal;
    }
    .collapsible:after {
      content: '\25BC';
      font-size: 0.9em;
      margin-left: 5px;
    }
    .collapsible.collapsed:after {
      content: '\25B6';
    }
    .collapsible-content {
      display: none;
      overflow: hidden;
      background-color: #f0f0f0;
      padding: 10px;
      border-radius: 5px;
      font-size: 0.9em;
    }
    #legend {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      padding: 5px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      width: 250px;
      word-wrap: break-word;
    }
    .noUi-target {
      background: #f0f0f0;
      border-radius: 5px;
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.1);
      height: 0.5em;
    }
    .noUi-connect {
      background: rgba(255, 255, 255, 0.0);
      height: 0.5em;
    }
    .noUi-connect-dark-grey {
      background: rgba(118, 118, 118, 1) !important;
    }
    .noUi-connect-gradient-right {
      background: linear-gradient(to right, rgba(118, 118, 118, 0) 0%, rgba(118, 118, 118, 0.5) 50%, rgba(118, 118, 118, 1) 100%)!important;
    }
    .noUi-connect-gradient-left {
      background: linear-gradient(to right, rgba(118, 118, 118, 1) 0%, rgba(118, 118, 118, 0.5) 50%, rgba(118, 118, 118, 0) 100%)!important;
    }
    .noUi-handle {
      background: rgba(118, 118, 118, 1) !important;
      border: none !important;
      border-radius: 50% !important;
      box-shadow: none !important;
      width: 14px !important;
      height: 14px !important;
      cursor: pointer !important;
      top: 50%;
      transform: translate(-50%, 5%) !important;
    }
    .noUi-handle-transparent {
      background: rgba(255, 255, 255, 0.0) !important;
      border: 0.5px solid #767676 !important;
    }
    .noUi-handle::after {
      content: attr(data-value);
      position: absolute;
      background: #007bff00;
      color: #000000;
      padding: 2px 5px;
      border: none;
      font-size: 0.8em;
      top: -18px;
      transform: translateX(-200%);
    }
    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
    }
    .slider-labels span {
      font-size: 0.8em;
    }
    .noUi-tooltip {
      background: #007bff;
      color: #fff;
      border-radius: 3px;
      padding: 5px;
      font-size: 0.9em;
    }
    .collapsible-content label,
    .collapsible-content select,
    .collapsible-content input {
      font-size: 0.8em;
      font-family: 'Trebuchet MS', sans-serif;
      font-weight: normal;
    }
    .panel-header {
      cursor: pointer;
      border: none;
      text-align: left;
      outline: none;
      font-size: 1.2em;
      background: white;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-radius: 5px;
      font-family: 'Trebuchet MS', sans-serif;
      font-weight: normal;
    }
    .panel-header:after {
      content: '\25BC';
      font-size: 0.9em;
      margin-left: 5px;
    }
    .panel-header.collapsed:after {
      content: '\25B6';
    }
    .checkbox-label {
      display: flex !important;
      align-items: center !important;
      font-size: 1em !important;
    }
    .checkbox-label input {
      padding: 15px !important;
      width: auto !important;
    }
    .checkbox-label span {
      margin-left: 6px !important;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="panel-container">
    <div id="panel" class="panel">
      <button class="panel-header">Connectivity Scores</button>
      <div id="panel-content">
        <label for="yearDropdown" class="large-font">Year:</label>
        <div id="yearDropdownContainer"></div>
        <br>
        <label for="purposeDropdown" class="large-font">Purpose of Travel:</label>
        <div id="purposeDropdownContainer"></div>
        <br>
        <label for="modeDropdown" class="large-font">Mode of Travel:</label>
        <div id="modeDropdownContainer"></div>
        <br>
        <button type="button" class="collapsible">Settings</button>
        <div class="collapsible-content">
          <label for="opacityFieldDropdown" class="medium-font">Link Hexagon Transparency to:</label>
          <select id="opacityFieldDropdown" class="small-font">
            <option value="None">None</option>
            <option value="pop">Population</option>
            <option value="imd">Index of Multiple Deprivation</option>
            <option value="carav">Car Availability</option>
            <option value="hh_fut">Future Dwellings</option>
          </select>
          <br>
          <div class="field-container">
            <div id="opacityRangeSliderContainer"></div>
          </div>
          <div class="field-container">
            <div class="button-container">
              <button id="inverseOpacityScaleButton" class="small-font">Inverse Scale</button>
            </div>
          </div>
          <br>
          <label for="outlineFieldDropdown" class="medium-font">Link Hexagon Outline to:</label>
          <select id="outlineFieldDropdown" class="small-font">
            <option value="None">None</option>
            <option value="imd">Index of Multiple Deprivation</option>
            <option value="pop">Population</option>
            <option value="carav">Car Availability</option>
            <option value="hh_fut">Future Dwellings</option>
          </select>
          <br>
          <div class="field-container">
            <div id="outlineRangeSliderContainer"></div>
          </div>
          <div class="field-container">
            <div class="button-container">
              <button id="inverseOutlineScaleButton" class="small-font">Inverse Scale</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="panel-amenities" class="panel">
      <button class="panel-header">Journey Time Catchments - Amenities</button>
      <div id="panel-content">
        <label for="yearDropdownAmenities" class="large-font">Year:</label>
        <div id="yearDropdownAmenitiesContainer"></div>
        <br>
        <label for="modeDropdownAmenities" class="large-font">Mode of Travel:</label>
        <div id="modeDropdownAmenitiesContainer"></div>
        <br>
        <label class="large-font">Amenities:</label>
        <div id="amenitiesCheckboxesContainer"></div>
        <br>
        <label class="large-font">Amenities:</label>
        <label class="checkbox-label"><input type="checkbox" value="PriSch"> <span>Primary School</span></label>
        <label class="checkbox-label"><input type="checkbox" value="SecSch"> <span>Secondary School</span></label>
        <label class="checkbox-label"><input type="checkbox" value="FurEd"> <span>Further Education</span></label>
        <label class="checkbox-label"><input type="checkbox" value="Em500"> <span>Employment (500+ jobs)</span></label>
        <label class="checkbox-label"><input type="checkbox" value="Em5000"> <span>Employment (5000+ jobs)</span></label>
        <label class="checkbox-label"><input type="checkbox" value="StrEmp"> <span>Strategic Employment</span></label>
        <label class="checkbox-label"><input type="checkbox" value="CitCtr"> <span>City Centre</span></label>
        <label class="checkbox-label"><input type="checkbox" value="MajCtr"> <span>Major Centre</span></label>
        <label class="checkbox-label"><input type="checkbox" value="DisCtr"> <span>District Centre</span></label>
        <label class="checkbox-label"><input type="checkbox" value="GP"> <span>General Practice</span></label>
        <label class="checkbox-label"><input type="checkbox" value="Hospital"> <span>Hospital</span></label>
        <br>
        <button id="drawMapAmenities" class="medium-font">Draw Map</button>
        <br>
        <button type="button" class="collapsible">Settings</button>
        <div class="collapsible-content">
          <label for="opacityFieldDropdownAmenities" class="medium-font">Link Hexagon Transparency to:</label>
          <select id="opacityFieldDropdownAmenities" class="small-font">
            <option value="None">None</option>
            <option value="pop">Population</option>
            <option value="imd">Index of Multiple Deprivation</option>
            <option value="carav">Car Availability</option>
            <option value="hh_fut">Future Dwellings</option>
          </select>
          <br>
          <div class="field-container">
            <div id="opacityRangeSliderAmenitiesContainer"></div>
          </div>
          <div class="field-container">
            <div class="button-container">
              <button id="inverseOpacityScaleButtonAmenities" class="small-font">Inverse Scale</button>
            </div>
          </div>
          <br>
          <label for="outlineFieldDropdownAmenities" class="medium-font">Link Hexagon Outline to:</label>
          <select id="outlineFieldDropdownAmenities" class="small-font">
            <option value="None">None</option>
            <option value="imd">Index of Multiple Deprivation</option>
            <option value="pop">Population</option>
            <option value="carav">Car Availability</option>
            <option value="hh_fut">Future Dwellings</option>
          </select>
          <br>
          <div class="field-container">
            <div id="outlineRangeSliderAmenitiesContainer"></div>
          </div>
          <div class="field-container">
            <div class="button-container">
              <button id="inverseOutlineScaleButtonAmenities" class="small-font">Inverse Scale</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="panel-hexagons" class="panel">
      <button class="panel-header">Journey Time Catchments - Hexagons</button>
      <div id="panel-hexagons-content">
        <label for="yearDropdownHexagons" class="large-font">Year:</label>
        <div id="yearDropdownHexagonsContainer"></div>
        <br>
        <label for="modeDropdownHexagons" class="large-font">Mode of Travel:</label>
        <div id="modeDropdownHexagonsContainer"></div>
        <br>
        <button id="drawMapButton" class="medium-font">Draw Map</button>
      </div>
    </div>
  </div>
  <div id="legend">
    <h4 style="font-size: 1.2em; margin-top: 0;">Legend</h4>
    <div id="legend-content"></div>
  </div>
  <script src="main.js"></script>
  <script>
    function createDropdown(id, options, className) {
      const select = document.createElement('select');
      select.id = id;
      select.className = className;
      options.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option.value;
        opt.text = option.text;
        select.add(opt);
      });
      return select;
    }
    document.addEventListener('DOMContentLoaded', (event) => {
      const yearOptions = [
        { value: '2024', text: '2024' },
        { value: '2023', text: '2023' },
        { value: '2022', text: '2022' },
        { value: '2021', text: '2021' }
      ];
      const purposeOptions = [
        { value: 'All', text: 'All Amenities' },
        { value: 'Edu', text: 'Education' },
        { value: 'Emp', text: 'Employment' },
        { value: 'HSt', text: 'High Street' },
        { value: 'Hth', text: 'Health' }
      ];
      const modeOptions = [
        { value: 'To', text: 'All Modes' },
        { value: 'Wa', text: 'Walk' },
        { value: 'Cy', text: 'Cycle' },
        { value: 'PT', text: 'Public Transport' },
        { value: 'Ca', text: 'Car' }
      ];
      document.getElementById('yearDropdownContainer').appendChild(createDropdown('yearDropdown', yearOptions, 'medium-font'));
      document.getElementById('purposeDropdownContainer').appendChild(createDropdown('purposeDropdown', purposeOptions, 'medium-font'));
      document.getElementById('modeDropdownContainer').appendChild(createDropdown('modeDropdown', modeOptions, 'medium-font'));
      document.getElementById('yearDropdownAmenitiesContainer').appendChild(createDropdown('yearDropdownAmenities', yearOptions, 'medium-font'));
      document.getElementById('modeDropdownAmenitiesContainer').appendChild(createDropdown('modeDropdownAmenities', modeOptions, 'medium-font'));
      document.getElementById('yearDropdownHexagonsContainer').appendChild(createDropdown('yearDropdownHexagons', yearOptions, 'medium-font'));
      document.getElementById('modeDropdownHexagonsContainer').appendChild(createDropdown('modeDropdownHexagons', modeOptions, 'medium-font'));
    });
  </script>
  <script>
    function createCheckbox(id, value, text) {
      const label = document.createElement('label');
      label.className = 'checkbox-label';
      const input = document.createElement('input');
      input.type = 'checkbox';
      input.value = value;
      label.appendChild(input);
      const span = document.createElement('span');
      span.textContent = text;
      label.appendChild(span);
      return label;
    }
    document.addEventListener('DOMContentLoaded', (event) => {
      const amenitiesOptions = [
        { value: 'PriSch', text: 'Primary School' },
        { value: 'SecSch', text: 'Secondary School' },
        { value: 'FurEd', text: 'Further Education' },
        { value: 'Em500', text: 'Employment (500+ jobs)' },
        { value: 'Em5000', text: 'Employment (5000+ jobs)' },
        { value: 'StrEmp', text: 'Strategic Employment' },
        { value: 'CitCtr', text: 'City Centre' },
        { value: 'MajCtr', text: 'Major Centre' },
        { value: 'DisCtr', text: 'District Centre' },
        { value: 'GP', text: 'General Practice' },
        { value: 'Hospital', text: 'Hospital' }
      ];
      const amenitiesContainer = document.getElementById('amenitiesCheckboxesContainer');
      amenitiesOptions.forEach(option => {
        amenitiesContainer.appendChild(createCheckbox(option.value, option.value, option.text));
      });
    });
  </script>
  <script>
    function createSlider(id, minId, maxId) {
      const container = document.createElement('div');
      const slider = document.createElement('div');
      slider.id = id;
      container.appendChild(slider);
      const labels = document.createElement('div');
      labels.className = 'slider-labels';
      const minLabel = document.createElement('span');
      minLabel.id = minId;
      minLabel.textContent = '0';
      labels.appendChild(minLabel);
      const maxLabel = document.createElement('span');
      maxLabel.id = maxId;
      maxLabel.textContent = '1';
      labels.appendChild(maxLabel);
      container.appendChild(labels);
      return container;
    }
    document.addEventListener('DOMContentLoaded', (event) => {
      document.getElementById('opacityRangeSliderContainer').appendChild(createSlider('opacityRangeSlider', 'opacityRangeMin', 'opacityRangeMax'));
      document.getElementById('outlineRangeSliderContainer').appendChild(createSlider('outlineRangeSlider', 'outlineRangeMin', 'outlineRangeMax'));
      document.getElementById('opacityRangeSliderAmenitiesContainer').appendChild(createSlider('opacityRangeSliderAmenities', 'opacityRangeMinAmenities', 'opacityRangeMaxAmenities'));
      document.getElementById('outlineRangeSliderAmenitiesContainer').appendChild(createSlider('outlineRangeSliderAmenities', 'outlineRangeMinAmenities', 'outlineRangeMaxAmenities'));
    });
  </script>
</body>
</html>
